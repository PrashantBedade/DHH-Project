<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({ pageLanguage: 'en' }, 'google_translate_element');
        }
    </script>
    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <link rel="stylesheet" href="../CSS/style.css">
    <title>DHH</title>
    <style>
        #dashboard-btn {
            background-color: #1f89e5;
            padding: 5px;
            color: #fff;
            font-size: 16px;
            font-weight: bold;
            border-radius: 10px;
            position: fixed;
            top: 20px;
            z-index: 1;
        }
    </style>
</head>

<body>
    <!-- Google Translate Widget -->
    <div class="header-icons">
        <div id="google_translate_element"></div>
    </div>
    <button id="dashboard-btn">Dashboard</button>

    <div class="headerdiv">
        <header class="headernav">
            <div class="img" id="logoimg">
                <img src="../assets/logo_blue.jpg" alt="Digital Health Hub Logo">
            </div>
            <!-- Navigation Menu -->
            <nav class="navbar">
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="AboutUs.html">About</a></li>
                    <li><a href="#contactusform">Contact us</a></li>
                    <li><a href="https://nrhm.maharashtra.gov.in/ems.htm#:~:text=Toll%20free%20number%20108%20has,Emergency%20Medical%20Services%20(MEMS)."
                            target="_blank">Emergency Contacts</a></li>
                    <li class="dropdown">
                        <a href="#services" class="dropbtn">Our Services <i class="fas fa-chevron-down"></i></a>
                        <!-- Dropdown -->
                        <div class="dropdown-content">
                            <a href="#bedavailabilitymain">Resource Availability</a>
                            <a href="./pharmacysearch copy.html" target="_blank">Pharmacy</a>
                            <a href="./bloodbanksearch.html" target="_blank">Blood Bank</a>
                            <a href="./login.html">Pathology</a>
                        </div>
                    </li>
                    <li><a id="loginbtn" href="login.html">Login</a></li>
                    <li><a id="registerbtn" href="patientregistrform.html">Register</a></li>
                </ul>
            </nav>
        </header>
    </div>


    <div class="mainbody">
        <div class="maincontentleft">
            <div id="mainimg">
                <img src="../assets/logo_blue.jpg" alt="Sample Image">
            </div>
            <div class="maintextinfo">
                <h2>DIGITAL HEALTH HUB</h2>
                <p>Efficient patient flow, smart resource management, and streamlined services like online appointments,
                    pharmacy, and blood bank support reduce wait times and improve resource use. This connected approach
                    enhances care, boosts efficiency, and makes healthcare more accessible for everyone.</p>
                <div class="mainbodybtn">
                    <button id="add-appointment-btn" class="bookappointment" aria-label="Add an Appointment">
                        Book Appointment
                    </button>
                    <button class="bookappointment bedavailability" aria-label="Check bed availability"
                        onclick="scrollToBedAvailability()">Resource Availability</button>
                </div>
            </div>
        </div>
        <div class="maincontentright">
            <img src="../assets/maincontentrightimg.png" alt="Healthcare Image">
        </div>
    </div>


    <section class="services" id="services-card">
        <div class="services-header">
            <h2>Our Services</h2>
        </div>
        <div class="services-container">

            <a href="./login.html" class="services-card">
                <i class="fas fa-calendar-check"></i>
                <h3>Appointment Booking</h3>
                <p>Book appointments with doctors easily and avoid long queues.</p>
            </a>

            <a href="#bedavailabilitymain" class="services-card">
                <i class="fas fa-bed"></i>
                <h3>Resource Availability</h3>
                <p>Check real-time availability of hospital resource across departments.</p>
            </a>

            <a href="./pharmacysearch copy.html" target="_blank" class="services-card">
                <i class="fas fa-pills"></i>
                <h3>Pharmacy</h3>
                <p>Order and track the availability of prescribed medications.</p>
            </a>

            <a href="./bloodbanksearch.html" target="_blank" class="services-card">
                <i class="fas fa-tint"></i>
                <h3>Blood Bank</h3>
                <p>Find and access blood bank resources in times of need.</p>
            </a>

            <a href="./login.html" class="services-card">
                <i class="fas fa-flask"></i>
                <h3>Pathology</h3>
                <p>Book pathology tests and access diagnostic services.</p>
            </a>
        </div>
    </section>



    <div class="bed-availability-container" id="bedavailabilitymain">
        <!-- Left Side: Form -->
        <div class="left-form">
            <h2 style="text-align: center;" class="Resourceh2">Check Resource Availability</h2>
            <form class="bed-check-form" onsubmit="checkAvailability(event)">
                <div class="form-row">
                    <label for="hospital-name">Hospital Name:</label>
                    <select id="hospital-name" name="hospital-name" required>
                        <option value="" disabled selected>Select Hospital</option>
                        <option value="digital-health-hub">Digital Health Hub</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="category">Category:</label>
                    <select id="category" name="category" required>
                        <option value="" disabled selected>Select Category</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="resource-type">Resource Type:</label>
                    <select id="resource-type" name="resource-type" required>
                        <option value="" disabled selected>Select Resource Type</option>
                    </select>
                </div>
                <div class="form-row">
                    <button type="submit" id="bedbtn">Check Availability</button>
                </div>
            </form>

        </div>

        <!-- Right Side: Results -->
        <div class="right-result">
            <h2 class="Resourceh2">Available Resources</h2>
            <div class="result-content">
                <!-- Default message if no results -->
                <p class="no-results">No results to display. Please search to see results.</p>
            </div>
        </div>
    </div>

    <div class="diseasecontainermain">
        <h2>SOME COMMON DISEASE</h2>
        <div class="diseasecontainer">

            <div class="disease-card">
                <img src="../assets/Fever.jpg" alt="Disease Image" class="disease-image">
                <div class="disease-info">
                    <h3>Fever</h3>
                    <p>Fever is a temporary rise in body temperature, signaling the body's response to infections or
                        illness.</p>
                </div>
            </div>

            <div class="disease-card">
                <img src="../assets/cough.jpg" alt="Disease Image" class="disease-image">
                <div class="disease-info">
                    <h3>Cough</h3>
                    <p>Cough is a reflex to clear the throat or airways, caused by infections, irritants, or allergies.
                    </p>
                </div>
            </div>

            <div class="disease-card">
                <img src="../assets/cold.jpg" alt="Disease Image" class="disease-image">
                <div class="disease-info">
                    <h3>Cold</h3>
                    <p>Cold is a viral infection causing a runny nose, sneezing, and mild discomfort in the upper
                        respiratory tract.</p>
                </div>
            </div>

            <div class="disease-card">
                <img src="../assets/Allergies.jpg" alt="Disease Image" class="disease-image">
                <div class="disease-info">
                    <h3>Allergies</h3>
                    <p>Allergies are immune reactions to harmless substances like pollen, causing sneezing or skin
                        rashes.</p>
                </div>
            </div>

            <div class="disease-card">
                <img src="../assets/headache.jpg" alt="Disease Image" class="disease-image">
                <div class="disease-info">
                    <h3>Headache</h3>
                    <p>Headache is pain in the head or neck, often due to stress, dehydration, or screen overuse.</p>
                </div>
            </div>
        </div>
    </div>

    <section class="bloodcontainer">
        <h2 class="sectiontitle">
            BLOOD TYPES
        </h2>
        <div class="bloodtypelist">
            <ul>
                <li><a href="bloodtype.html#O-negative">O<sup>-ve</sup></a></li>
                <li><a href="bloodtype.html#O-positive">O<sup>+ve</sup></a></li>
                <li><a href="bloodtype.html#A-negative">A<sup>-ve</sup></a></li>
                <li><a href="bloodtype.html#A-positive">A<sup>+ve</sup></a></li>
                <li><a href="bloodtype.html#B-negative">B<sup>-ve</sup></a></li>
                <li><a href="bloodtype.html#B-positive">B<sup>+ve</sup></a></li>
                <li><a href="bloodtype.html#AB-negative">AB<sup>-ve</sup></a></li>
                <li><a href="bloodtype.html#AB-positive">AB<sup>+ve</sup></a></li>
            </ul>
        </div>
    </section>


    <div class="csection" id="contactusform">
        <img src="../assets/contacytus.png" alt="">
        <div class="contactform">
            <form id="contact-form" class="contactusform" onsubmit="sendContactUs(event)">
                <h2>Contact Us Form</h2>
                <div class="line1">
                    <div>
                        <label for="name">Name:</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    <div>
                        <label for="Phone_no">Phone No:</label>
                        <input type="number" id="Phone_no" name="Phone_no" required>
                    </div>
                </div>
                <div class="line1">
                    <div>
                        <label for="Address">Address:</label>
                        <input type="text" id="Address" name="Address" required>
                    </div>
                    <div>
                        <label for="email">Email ID:</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                </div>
                <div class="line3">
                    <label for="message">Message:</label>
                    <textarea id="message" name="message" required></textarea>
                </div>
                <div class="submitbtn">
                    <button type="submit">Submit</button>
                </div>
            </form>
        </div>
    </div>
    <div id="footer"></div>


    <div id="chatbot-container">
        <div id="chatbot-header">
            Chatbot
            <button style="float:right; background:none; border:none; color:rgb(255, 255, 255); font-size:16px;"
                onclick="closeChatbot()">×</button>
        </div>
        <div id="chatbot-messages">
            <!-- Messages will appear here -->
        </div>
        <div style="padding:10px; border-top:1px solid #ccc; color:aqua">
            <input id="chatbot-input" type="text" placeholder="Just type a name of disease to get infromation..." />
            <button id="send-btn" onclick="sendMessage()">Send</button>
        </div>
    </div>
    <button class="chatbot-btn" id="chatbotbtn" onclick="toggleChatbot()">
        <i class="fas fa-comment-dots"></i>
    </button>



    <!-- Add Back to Top Button -->
    <button class="back-to-top-btn" onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>



    <script>
        function checkAndRedirect(roleChecks) {
            // Get the JWT token from localStorage
            const token = localStorage.getItem('authToken');

            if (!token) {
                alert('No session found. Please log in.');
                window.location.href = 'login.html';
                return;
            }

            // Decode the JWT token
            let payload;
            try {
                payload = JSON.parse(atob(token.split('.')[1])); // Decode base64 part of JWT token
            } catch (error) {
                console.error('Invalid token format:', error);
                window.location.href = 'login.html'; // Redirect to login on token error
                return;
            }

            // Check the token payload against the roleChecks mapping
            for (const [key, redirectUrl] of Object.entries(roleChecks)) {
                if (payload[key]) {
                    window.location.href = redirectUrl;
                    return;
                }
            }

            alert('No valid role found for this action.');
        }

        // Handle "Dashboard" button
        document.getElementById('dashboard-btn').addEventListener('click', () => {
            checkAndRedirect({
                patientID: 'patientDashboard.html',
                doctorID: 'doctorDashboard.html',
                nurseID: 'nurseDashboard.html',
                receptionistID: 'receptionistDashboard.html',
                bloodbankID: 'bloodbankDashboard.html',
                pharmacyID: 'pharmacyDashboard.html',
                pathologyID: 'pathologyDashboard.html',
            });
        });

        // Handle "Add Appointment" button
        document.getElementById('add-appointment-btn').addEventListener('click', () => {
            checkAndRedirect({
                patientID: 'patientDashboard.html', // Redirect only for patients
            });
        });

        // Handle "Appointment Booking" link
        document.querySelector('.services-card').addEventListener('click', (event) => {
            event.preventDefault(); // Prevent default anchor behavior
            checkAndRedirect({
                patientID: 'patientDashboard.html', // Redirect only for patients
            });
        });

        async function sendContactUs(event) {
            event.preventDefault();

            const name = document.getElementById("name").value;
            const phoneNo = document.getElementById("Phone_no").value;
            const address = document.getElementById("Address").value;
            const email = document.getElementById("email").value;
            const message = document.getElementById("message").value;

            try {
                const response = await fetch('http://localhost:5011/api/contact/contactus', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name,
                        phoneNo,
                        address,
                        email,
                        message
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert(data.message);
                    // Reset individual input fields after form submission
                    document.getElementById("name").value = '';
                    document.getElementById("Phone_no").value = '';
                    document.getElementById("Address").value = '';
                    document.getElementById("email").value = '';
                    document.getElementById("message").value = '';
                } else {
                    alert(data.message || 'Failed to submit the form. Please try again.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred. Please try again later.');
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
    fetchUniqueCategories();

    document.getElementById("category").addEventListener("change", fetchUniqueResources);
    document.getElementById("availability-form").addEventListener("submit", checkAvailability);
});

// Base API URL
const API_BASE_URL = "http://localhost:5011/api/resources";

// Fetch unique categories
async function fetchUniqueCategories() {
    try {
        const response = await fetch(`${API_BASE_URL}/unique-categories`);
        const data = await response.json();

        if (data.success) {
            const categorySelect = document.getElementById("category");
            categorySelect.innerHTML = `<option value="">Select Category</option>`; // Reset options

            data.categories.forEach(category => {
                const option = document.createElement("option");
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        } else {
            throw new Error(data.message || "Failed to fetch categories.");
        }
    } catch (error) {
        console.error("Error fetching categories:", error);
        showError("Failed to load categories. Please try again.");
    }
}

// Fetch unique resources based on selected category
async function fetchUniqueResources() {
    const category = document.getElementById("category").value;
    const resourceSelect = document.getElementById("resource-type");

    if (!category) {
        resourceSelect.innerHTML = `<option value="">Select a category first</option>`;
        return;
    }

    try {
        const response = await fetch(`${API_BASE_URL}/unique-resources?category=${encodeURIComponent(category)}`);
        const data = await response.json();

        if (data.success) {
            resourceSelect.innerHTML = `<option value="">Select Resource Type</option>`; // Reset options

            data.resourceTypes.forEach(resource => {
                const option = document.createElement("option");
                option.value = resource;
                option.textContent = resource;
                resourceSelect.appendChild(option);
            });
        } else {
            throw new Error(data.message || "Failed to fetch resources.");
        }
    } catch (error) {
        console.error("Error fetching resources:", error);
        showError("Failed to load resources. Please try again.");
    }
}

// Check availability of a resource
async function checkAvailability(event) {
    event.preventDefault();

    const hospitalName = document.getElementById("hospital-name").value;
    const category = document.getElementById("category").value;
    const resourceType = document.getElementById("resource-type").value;
    const resultContent = document.querySelector(".result-content");
    
    resultContent.innerHTML = ""; // Clear previous results

    if (!hospitalName || !category || !resourceType) {
        alert("Please fill out all required fields.");
        return;
    }

    try {
        const response = await fetch(`${API_BASE_URL}/availability`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ hospitalName, category, resourceType }),
        });

        const data = await response.json();

        if (!response.ok) {
            resultContent.innerHTML = `<p style="color: red;">Error: ${data.message}</p>`;
            return;
        }

        // Injecting the results into the result-content div
        resultContent.innerHTML = `
        <div style="display: block; align-items: center;">
            <div style="text-align: left; font-size: 20px; color: #000000; font-weight: bold;">
                Total ${resourceType}:
                <span style="display: block; font-size: 100px; color: #1F89E5;">
                    ${data.total}
                </span>
            </div>
            <div style="text-align: right; font-size: 20px; color: #000000; font-weight: bold;">
                Available ${resourceType}:
                <span style="display: block; position:relative; right:5px; bottom:5px; font-size: 100px; color: #1F89E5;">
                    ${data.available}
                </span>
            </div>
        </div>`;
    } catch (error) {
        console.error("Error checking availability:", error);
        resultContent.innerHTML = `<p style="color: red;">An error occurred while checking resource availability.</p>`;
    }
}

// Utility function to show error messages
function showError(message) {
    const resultContent = document.querySelector(".result-content");
    resultContent.innerHTML = `<p style="color: red;">${message}</p>`;
}

        // Back to Top Button Logic
        const backToTopBtn = document.querySelector('.back-to-top-btn');

        // Show or hide the back-to-top button based on scroll position
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                backToTopBtn.style.display = 'block';
            } else {
                backToTopBtn.style.display = 'none';
            }
        });

        // Scroll to the top when the button is clicked
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

// Toggle function to open/close the chatbot
function toggleChatbot() {
    const chatbotContainer = document.getElementById("chatbot-container");
    chatbotContainer.style.display = chatbotContainer.style.display === "block" ? "none" : "block";
}

// Close the chatbot explicitly
function closeChatbot() {
    document.getElementById("chatbot-container").style.display = "none";
}

// Function to send a message
async function sendMessage() {
    const inputField = document.getElementById("chatbot-input");
    const input = inputField.value.trim(); // Trim whitespace

    if (!input) {
        inputField.value = ""; // Ensure input is cleared
        return; // Do nothing if input is empty
    }

    // Display user's message in the chat window
    const messages = document.getElementById("chatbot-messages");
    messages.innerHTML += `<div style="text-align: right; font-size: 14px; background-color: #1F89E5; color: white; 
        border-radius: 10px; padding: 10px; margin: 5px; max-width: 80%;">${input}</div>`;

    try {
        // Send message to backend API
        const response = await fetch("http://localhost:5000/chatbot", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: input }),
        });

        const data = await response.json();

        // Display bot's reply in the chat window
        messages.innerHTML += `<div style="text-align: left; font-size: 14px; background-color: #000; color: white; 
            border-radius: 10px; padding: 10px; margin: 5px; max-width: 80%;">${data.reply}</div>`;
        messages.scrollTop = messages.scrollHeight; // Scroll to the bottom
    } catch (error) {
        console.error("Error sending message:", error);
    }

    inputField.value = ""; // Clear the input field after sending
}

// Add event listener for Enter key to send message
document.getElementById("chatbot-input").addEventListener("keydown", function (event) {
    if (event.key === "Enter") {
        event.preventDefault(); // Prevent default form submission
        sendMessage(); // Call the sendMessage function
    }
});



        // Redirect to the login page
        function redirectToLogin() {
            window.location.href = "./login.html"; // Replace 'login.html' with your login page URL
        }

        // Scroll to the bed availability section
        function scrollToBedAvailability() {
            const bedAvailabilitySection = document.getElementById("bedavailabilitymain");
            if (bedAvailabilitySection) {
                bedAvailabilitySection.scrollIntoView({ behavior: "smooth" });
            } else {
                console.error("Element with id 'bedavailabilitymain' not found.");
            }
        }

        window.onload = function () {
            fetchUniqueResources();
            fetchUniqueCategories();
        };

        document.addEventListener("DOMContentLoaded", () => {
            const links = document.querySelectorAll(".bloodtypelist a");

            links.forEach(link => {
                link.addEventListener("click", (e) => {
                    // Extract the target section from the href
                    const href = link.getAttribute("href");
                    if (href.includes("#")) {
                        const [page, id] = href.split("#");
                        sessionStorage.setItem("scrollTo", id);
                        window.location.href = page; // Redirect to bloodtype.html
                    }
                });
            });
        });

        // Placeholder function for Chatbot
        function openChatbot() {
            document.getElementById("chatbot-container").style.display = "block";
        }

        function closeChatbot() {
            document.getElementById("chatbot-container").style.display = "none";
        }

        async function sendMessage() {
            const input = document.getElementById("chatbot-input").value;
            if (input.trim() === "") return;

            // Append user's message to the messages area
            const messages = document.getElementById("chatbot-messages");
            messages.innerHTML += `<div style="text-align:right; margin:5px;">${input}</div>`;

            // Send message to backend API
            const response = await fetch("http://localhost:5012/chatbot", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message: input }),
            });
            const data = await response.json();

            // Append chatbot's response
            messages.innerHTML += `<div style="text-align:left; margin:5px; background:#1F89E5; border-radius:10px; padding:5px;">${data.reply}</div>`;
            messages.scrollTop = messages.scrollHeight; // Scroll to the bottom
        }

        fetch("../Html/footer.html")
            .then(response => {
                if (!response.ok) {
                    throw new Error("Failed to load footer");
                }
                return response.text();
            })
            .then(data => {
                document.getElementById("footer").innerHTML = data;
            })
            .catch(err => console.error("Error loading footer:", err));


    </script>

</body>

</html>